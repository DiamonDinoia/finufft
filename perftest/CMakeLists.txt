# Each source test file is instantiated in single and double precision
set(PERFTESTS guru_timing_test manysmallprobs spreadtestnd)

foreach(TEST ${PERFTESTS})
  add_executable(${TEST} ${TEST}.cpp)
  add_executable(${TEST}f ${TEST}.cpp)

  target_compile_definitions(${TEST}f PRIVATE -DSINGLE)

  if(FINUFFT_STATIC_LINKING)
      target_link_libraries(${TEST} PRIVATE finufft_static)
      target_link_libraries(${TEST}f PRIVATE finufft_static)
      if(FINUFFT_USE_OPENMP)
          target_link_libraries(${TEST} PRIVATE OpenMP::OpenMP_CXX)
          target_link_libraries(${TEST}f PRIVATE OpenMP::OpenMP_CXX)
          if(WIN32)
              target_link_options(${TEST} PRIVATE ${OpenMP_CXX_FLAGS})
              target_link_options(${TEST}f PRIVATE ${OpenMP_CXX_FLAGS})
          endif()
      endif()
  else()
      target_link_libraries(${TEST} PRIVATE finufft)
      target_link_libraries(${TEST}f PRIVATE finufft)
      if(WIN32)
          target_compile_definitions(${TEST} PRIVATE FINUFFT_DLL)
          target_compile_definitions(${TEST}f PRIVATE FINUFFT_DLL)
      endif()
  endif()
  enable_asan(${TEST})
  enable_asan(${TEST}f)
endforeach()
